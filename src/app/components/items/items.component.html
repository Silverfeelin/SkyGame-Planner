<div class="sky-card">
  <div class="sky-card-header">
    <h1 class="h2 mb-0">Items</h1>
  </div>
  <div class="sky-card-body">
    <div class="grid grid-2">
      <a class="container" [routerLink]="'/item/field-guide'">
        <mat-icon class="menu-icon">photo_library</mat-icon>
        <span class="menu-label">
          Field guide
        </span>
      </a>
      <a class="container" [routerLink]="'/item/unlock-calculator'">
        <mat-icon class="menu-icon">calculate</mat-icon>
        <span class="menu-label">
          Unlock cost calculator
        </span>
      </a>
      <a class="container" [routerLink]="'/item/inflation'">
        <mat-icon class="menu-icon">trending_up</mat-icon>
        <span class="menu-label">
          Item inflation
        </span>
      </a>
      <a class="container" [routerLink]="'/item/unlock'">
        <mat-icon class="menu-icon">lock_open</mat-icon>
        <span class="menu-label">
          Quick unlock
        </span>
      </a>
    </div>
  </div>
</div>

<!-- Categories -->
<div class="sky-card mt">
  <div class="sky-card-header">
    <h2 class="h3 mb-0">Type</h2>
  </div>
  <div class="sky-card-body">
    <app-item-type-selector [type]="type" (typeChanged)="onTypeChanged($event)"></app-item-type-selector>
  </div>
</div>

<!-- Items -->
<div class="sky-card mt" *ngIf="shownItems">
  <div class="sky-card-header">
    <div class="unlock-bar">
      <span class="show-desktop">
        You have unlocked
        <b [class.completed]="shownUnlocked == shownCount">{{ shownUnlocked }}</b>
        out of
        <b [class.completed]="shownUnlocked == shownCount">{{ shownCount }}</b>
        items.
      </span>
      <span class="show-mobile">
        <b [class.completed]="shownUnlocked == shownCount">{{ shownUnlocked }}</b>
        /
        <b [class.completed]="shownUnlocked == shownCount">{{ shownCount }}</b>
        unlocked
      </span>
      <div class="fav-toggle" [class.toggle-active]="showFilters" (click)="toggleFilters()">
        <mat-icon [ngbTooltip]="'Filter items'" container="body" placement="left">filter_alt</mat-icon>
      </div>
    </div>
  </div>

  <div class="sky-card-body">
  @if (showFilters) {
      <div class="container mb">
        <!-- General filters -->
        <div class="search">
          <mat-icon>search</mat-icon>
          <input type="text" placeholder="Item name" [value]="filterName" (input)="onFilterNameInput($event)">
        </div>
        <div class="mt-half">
          <b class="point" (click)="showGeneralFilters=!showGeneralFilters" [class.c-old]="hasGeneralFilters">
            {{ showGeneralFilters ? '-' : '+' }} General
          </b>
          <div class="sky-flex flex-wrap" [hidden]="!showGeneralFilters">
            <button (click)="toggleFilter('owned')">
              <mat-icon class="menu-icon"><app-checkbox [state]="filters['owned']" [falseAsIndeterminate]="true" [useColors]="true"></app-checkbox></mat-icon>
              <span class="menu-label">Owned</span>
            </button>
            <button (click)="toggleFilter('favourite')">
              <mat-icon class="menu-icon"><app-checkbox [state]="filters['favourite']" [falseAsIndeterminate]="true" [useColors]="true"></app-checkbox></mat-icon>
              <span class="menu-label">Favourited</span>
            </button>
            <button (click)="toggleFilter('limited')">
              <mat-icon class="menu-icon"><app-checkbox [state]="filters['limited']" [falseAsIndeterminate]="true" [useColors]="true"></app-checkbox></mat-icon>
              <span class="menu-label">Limited</span>
            </button>
            <button (click)="toggleFilter('iap')">
              <mat-icon class="menu-icon"><app-checkbox [state]="filters['iap']" [falseAsIndeterminate]="true" [useColors]="true"></app-checkbox></mat-icon>
              <span class="menu-label">In-App Purchase</span>
            </button>
            <button (click)="toggleFilter('returned')">
              <mat-icon class="menu-icon"><app-checkbox [state]="filters['returned']" [falseAsIndeterminate]="true" [useColors]="true"></app-checkbox></mat-icon>
              <span class="menu-label">Has returned</span>
            </button>
          </div>
        </div>
        <!-- Realm filters -->
        <div class="mt-half">
          <b class="point" (click)="showRealmFilters=!showRealmFilters" [class.c-old]="hasRealmFilters">
            {{ showRealmFilters ? '-' : '+' }} Realms
          </b>
        </div>
        <div class="sky-flex flex-wrap" [hidden]="!showRealmFilters">
          <button (click)="toggleRealmFilters()">
            <mat-icon class="menu-icon"><app-checkbox [state]="allRealmsFiltered" [falseAsIndeterminate]="true" [useColors]="true"></app-checkbox></mat-icon>
            <span class="menu-label">
              All
            </span>
          </button>
          @for (realm of realms; track realm.guid) {
            <button (click)="toggleRealmFilter(realm)" [ngbTooltip]="realm.name" container="body" placement="top">
              <mat-icon class="menu-icon"><app-checkbox [state]="filterRealms[realm.guid]" [falseAsIndeterminate]="true" [useColors]="true"></app-checkbox></mat-icon>
              <span class="menu-label">
                {{ realm.name }}
              </span>
            </button>
          }
        </div>
        <!-- Season filters -->
        <div class="mt-half">
          <b class="point" (click)="showSeasonFilters=!showSeasonFilters" [class.c-old]="hasSeasonFilters">
            {{ showSeasonFilters ? '-' : '+' }} Seasons
          </b>
        </div>
        <div class="sky-flex flex-wrap" [hidden]="!showSeasonFilters">
          <button (click)="toggleSeasonFilters()">
            <mat-icon class="menu-icon"><app-checkbox [state]="allSeasonsFiltered" [falseAsIndeterminate]="true" [useColors]="true"></app-checkbox></mat-icon>
            <span class="menu-label">
              All
            </span>
          </button>
          @for (season of seasons; track season.guid) {
            <button (click)="toggleSeasonFilter(season)" [ngbTooltip]="season.name" container="body" placement="top">
              <mat-icon class="menu-icon"><app-checkbox [state]="filterSeasons[season.guid]" [falseAsIndeterminate]="true" [useColors]="true"></app-checkbox></mat-icon>
              <span class="menu-label">
                <app-icon [width]="'24px'" [height]="'24px'" [src]="season.iconUrl || '#season-candle'"></app-icon>
                <!-- {{ season.shortName }} -->
              </span>
            </button>
          }
        </div>
        <!-- Event filters -->
        <div class="mt-half">
          <b class="point" (click)="showEventFilters = !showEventFilters" [class.c-old]="hasEventFilters">
            {{ showEventFilters ? '-' : '+' }} Events
          </b>
        </div>
        <div class="sky-flex flex-wrap" [hidden]="!showEventFilters">
          <button (click)="toggleEventFilters()">
            <mat-icon class="menu-icon"><app-checkbox [state]="allEventsFiltered" [falseAsIndeterminate]="true" [useColors]="true"></app-checkbox></mat-icon>
            <span class="menu-label">
              All
            </span>
          </button>
          @for (event of events; track event.guid) {
            <button (click)="toggleEventFilter(event)" [ngbTooltip]="event.name" container="body" placement="top">
              <mat-icon class="menu-icon"><app-checkbox [state]="filterEvents[event.guid]" [falseAsIndeterminate]="true" [useColors]="true"></app-checkbox></mat-icon>
              <span class="menu-label">
                {{ event.name }}
              </span>
            </button>
          }
        </div>
        <hr/>
        <div class="mt">
          @if (unfilteredItemCount === 1) {
            There is <b>1</b> item
          } @else {
            There are <b>{{ unfilteredItemCount }}</b> items
          }
          <span class="c-accent">(out of {{ shownItems.length }})</span> matching the selected filters.
          <button type="button" class="button-danger" (click)="clearFilters()">Clear filters</button>
        </div>
      </div>
    }
    <div class="sky-flex flex-wrap">
      @if (showFilters && !unfilteredItemCount) {
        <div class="container">
          No items match the selected filters.
        </div>
      }
      @for (item of shownItems; track item.guid; let i = $index) {
        <a class="item-icon" [routerLink]="['/item', item.guid]" [hidden]="showFilters && !unfilteredItems[item.guid]">
          <app-item-icon [item]="item" [subIcons]="['type', 'season', 'elder', 'iap', 'favourite', 'unlock', 'limited']"
            [class.highlight]="item && item === selectedItem"
            [class.item-unlocked]="item.unlocked"
            [ngbTooltip]="item.name" container="body" placement="auto" >
          </app-item-icon>
        </a>
      }
    </div>
  </div>
</div>
